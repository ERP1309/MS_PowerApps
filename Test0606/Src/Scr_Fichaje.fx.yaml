Scr_Fichaje As screen:
    BackgroundImage: ='pattern_cubes-3_4_5_0-0_35_2__dddddd_eeeeee'
    ImagePosition: =ImagePosition.Fill

    "Map1 As 'Mapa (versión preliminar)'.pcfdataset":
        BorderColor: =RGBA(0, 18, 107, 1)
        Compass: =false
        CurrentLocation: =false
        CurrentLocationLatitude: =Latitude_1
        CurrentLocationLongitude: =Longitude_1
        DefaultLatitude: =Latitude_1
        DefaultLocation: =true
        DefaultLongitude: =Longitude_1
        DefaultZoomLevel: =15
        DisplayMode: =DisplayMode.Edit
        Height: =583
        InfoCards: ='Map.InfoCards'.None
        Items: =Location
        ItemsLatitudes: ="Latitude"
        ItemsLongitudes: ="Longitude"
        PinColor: =RGBA(255, 0, 0, 1)
        Pitch: =false
        Visible: =true
        Width: =640
        X: =0
        Y: =552
        ZIndex: =8
        Zoom: =false

    Lbl_Fecha_Marc As label:
        Height: =68
        Size: =21
        Text: =Text(Fecha_1,"dd/mm/yyyy")
        Width: =193
        X: =200
        Y: =298
        ZIndex: =9

    LBl_Hora_Marc As label:
        Height: =54
        Size: =21
        Text: |-
            =Text(hora_1,"h:mm")
        Width: =193
        X: =200
        Y: =366
        ZIndex: =10

    Label10 As label:
        FontWeight: =FontWeight.Bold
        Height: =63
        Size: =25
        Text: |-
            ="Fecha:"
        Width: =138
        X: =23
        Y: =298
        ZIndex: =11

    Label10_1 As label:
        FontWeight: =FontWeight.Bold
        Height: =54
        Size: =25
        Text: |-
            ="Hora:"
        Width: =119
        X: =23
        Y: =366
        ZIndex: =12

    Button4 As button:
        Height: =70
        OnSelect: |-
            =Set(
                Latitude_1,
                Text(Location.Latitude)
            ) And Set(
                Longitude_1,
                Text(Location.Longitude)
            ) And Set(
                Fecha_1,
                Today()
            ) And Set(
                hora_1,
                TimeValue(
                    Text(
                        Now(),
                        "h:mm"
                    ),
                    "es-MX"
                )
            ) And If(
                Dd_Tip_marca.Selected.'Tipo Marcación' = "Entrada",
                (Set(
                    Tiempo_Tardanza,
                    If(
                        DateDiff(
                            DateAdd(
                                Text(
                                    LookUp(
                                        Tabla2,
                                        Empresas = Dd_empresa.Selected.Empresas,
                                        'Horario Entrada'
                                    ),
                                    "h:mm"
                                ),
                                Text(
                                    LookUp(
                                        Tabla2,
                                        Empresas = Dd_empresa.Selected.Empresas,
                                        'Tiempo de Tolerancia (Min.)'
                                    ),
                                    "h:mm"
                                ),
                                TimeUnit.Minutes
                            ),
                            Text(
                                hora_1,
                                "h:mm"
                            ),
                            TimeUnit.Minutes
                        ) > 0,
                        DateDiff(
                            Text(
                                LookUp(
                                    Tabla2,
                                    Empresas = Dd_empresa.Selected.Empresas,
                                    'Horario Entrada'
                                ),
                                "h:mm"
                            ),
                            Text(
                                hora_1,
                                "h:mm"
                            ),
                            TimeUnit.Minutes
                        ),
                        0
                    )
                )),
                If(
                    Dd_Tip_marca.Selected.'Tipo Marcación' = "Salida",
                    Set(
                        Min_Adicionales,
                        If(
                            DateDiff(
                                Text(
                                    hora_1,
                                    "h:mm am/pm"
                                ),
                                Text(
                                    LookUp(
                                        Tabla2,
                                        Empresas = Text(Dd_empresa.Selected.Empresas),
                                        'Horario Salida'
                                    ),
                                    "h:mm am/pm"
                                ),
                                TimeUnit.Minutes
                            ) < 0,
                            DateDiff(
                                Text(
                                    LookUp(
                                        Tabla2,
                                        Empresas = Text(Dd_empresa.Selected.Empresas),
                                        'Horario Salida'
                                    ),
                                    "h:mm am/pm"
                                ),
                                Text(
                                    hora_1,
                                    "h:mm am/pm"
                                ),
                                TimeUnit.Minutes
                            ),
                            0
                        )
                    )
                )
            );
            Patch(
                Tabla1,
                Defaults(Tabla1),
                {Guid: Text(GUID())},
                {'Usuario Marcación': UserBD.'Id. Usuario'},
                {'Nombre Completo': UsuariosdeOffice365.UserProfile(UserBD.Correo).DisplayName},
                {'E-Mail': UsuariosdeOffice365.UserProfile(UserBD.Correo).Mail},
                {'Empresa Asiganada': Dd_empresa.Selected.Empresas},
                {Latitude: Latitude_1},
                {Longitude: Longitude_1},
                {'Tipo De Marcación': Dd_Tip_marca.Selected.'Tipo Marcación'},
                {'Fecha Marcación': Text(
                        Fecha_1,
                        "dd/mm/yyyy"
                    )
                },
                {'Hora Marcación': hora_1},
                {Tardanza: Tiempo_Tardanza},
                {'Minutos Adicionales':Min_Adicionales}
            
            );
            Navigate(
                Scr_Menu,
                ScreenTransition.Cover
            )
        Size: =24
        Text: ="Registrar Ingreso"
        Width: =280
        X: =40
        Y: =440
        ZIndex: =13

    Button4_1 As button:
        Height: =70
        OnSelect: |-
            =Set(
                Latitude_1,
                Text(Location.Latitude)
            ) And Set(
                Longitude_1,
                Text(Location.Longitude)
            ) And Set(
                Fecha_1,
                Today()
            ) And Set(
                hora_1,
                TimeValue(
                    Text(
                        Now(),
                        "h:mm am/pm"
                    ),
                    "es-MX"
                )
            ) And Set(
                Min_Adicionales,
                If(
                    DateDiff(
                        Text(
                            hora_1,
                            "h:mm am/pm"
                        ),
                        Text(
                            LookUp(
                                Tabla2,
                                Empresas = Text(Dd_empresa.Selected.Empresas),
                                'Horario Salida'
                            ),
                            "h:mm am/pm"
                        ),
                        TimeUnit.Minutes
                    ) < 0,
                    DateDiff(
                        Text(
                            LookUp(
                                Tabla2,
                                Empresas = Text(Dd_empresa.Selected.Empresas),
                                'Horario Salida'
                            ),
                            "h:mm am/pm"
                        ),
                        Text(
                            hora_1,
                            "h:mm am/pm"
                        ),
                        TimeUnit.Minutes
                    ),
                    0
                )
            );
            Patch(
                Tabla1,
                Defaults(Tabla1),
                {Guid: Text(GUID())},
                {'Usuario Marcación': UserBD.'Id. Usuario'},
                {'Nombre Completo': UsuariosdeOffice365.UserProfile(UserBD.Correo).DisplayName},
                {'E-Mail':UsuariosdeOffice365.UserProfile(UserBD.Correo).Mail},
                {'Empresa Asiganada':Dd_empresa.Selected.Empresas},
                {Latitude: Latitude_1},
                {Longitude: Longitude_1},
                {'Tipo De Marcación': "Salida"},
                {'Fecha Marcación':Text(Fecha_1,"dd/mm/yyyy")},
                {'Hora Marcación': hora_1},
                {'Minutos Adicionales':Min_Adicionales}
            );Navigate(Scr_Menu,ScreenTransition.Cover)
        Size: =24
        Text: ="Registrar Salida"
        Width: =280
        X: =336
        Y: =440
        ZIndex: =14

    Dd_empresa As dropdown:
        Height: =70
        Items: =Tabla2
        Size: =21
        Width: =299
        X: =306
        Y: =120
        ZIndex: =16

    Label2 As label:
        FontWeight: =FontWeight.Bold
        Height: =70
        Size: =21
        Text: |-
            ="Empresa Asignada:"
        Width: =282
        X: =23
        Y: =120
        ZIndex: =17

    Dd_Tip_marca As dropdown:
        Height: =70
        Items: =Tabla4
        Size: =21
        Width: =299
        X: =305
        Y: =214
        ZIndex: =18

    Label2_2 As label:
        FontWeight: =FontWeight.Bold
        Height: =70
        Size: =21
        Text: |-
            ="Tipo Marcación:"
        Width: =282
        X: =23
        Y: =214
        ZIndex: =19

